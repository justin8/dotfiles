#!/bin/bash

usage="usage: $0 -c {up|down|mute}"
id_store="/tmp/.${USER}-volume"
id=0
increment=5
display_volume=0
command=
icon_name=

while getopts h opt
do case "$opt" in
	h) echo "$usage"; exit 0;;
	?) echo "$usage"; exit 0;;
esac
done

shift $(($OPTIND - 1))
command=$1

if [[ -z $command ]]; then
	echo "$usage"
	exit 0;
fi

if [[ $command == "up" ]]; then
	pamixer --unmute --increase $increment
elif [[ $command == "down" ]]; then
	pamixer --decrease $increment
fi

display_volume=$(pamixer --get-volume)

if [[ $command = "mute" ]]; then
	pamixer --toggle-mute
	if pamixer --get-mute > /dev/null; then
		display_volume=0
		icon_name="notification-audio-volume-muted"
	fi
fi

if [[ -z $icon_name ]]; then
	if [[ "$display_volume" == "0" ]]; then
		icon_name="notification-audio-volume-off"
	else
		if [[ $display_volume -lt 33 ]]; then
			icon_name="notification-audio-volume-low"
		else
			if [[ $display_volume -lt 67 ]]; then
				icon_name="notification-audio-volume-medium"
			else
				icon_name="notification-audio-volume-high"
			fi
		fi
	fi
fi

find "${id_store}" -mmin +1 -exec rm {} \;
[[ -f ${id_store} ]] && id=$(cat ${id_store})

notify-send ' ' -i $icon_name -h int:value:$display_volume -h string:synchronous:volume -r $id -p > "${id_store}"
