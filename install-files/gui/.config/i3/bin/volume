#!/bin/bash

usage="usage: $0 {up|down|mute|get}"
id_store="/tmp/.${USER}-volume"
increment=5
id=0
display_volume=0
command=
icon_name=

function get_icon {
    display_volume=$(pamixer --get-volume)
    if pamixer --get-mute > /dev/null; then
        display_volume=0
        icon_name="notification-audio-volume-muted"
        symbol="ðŸ”‡"
    else
        if [[ "$display_volume" == "0" ]]; then
            icon_name="notification-audio-volume-off"
            symbol="ðŸ”ˆ"
        else
            if [[ $display_volume -lt 33 ]]; then
                icon_name="notification-audio-volume-low"
                symbol="ðŸ”ˆ"
            else
                if [[ $display_volume -lt 67 ]]; then
                    icon_name="notification-audio-volume-medium"
                    symbol="ðŸ”‰"
                else
                    icon_name="notification-audio-volume-high"
                    symbol="ðŸ”Š"
                fi
            fi
        fi
    fi
}

while getopts h opt
do case "$opt" in
    h) echo "$usage"; exit 0;;
    ?) echo "$usage"; exit 0;;
esac
done

shift $(($OPTIND - 1))
command=$1

if [[ -z $command ]]; then
    echo "$usage"
    exit 0;
fi

if [[ $command == "get" ]]; then
    get_icon
    echo "${symbol} ${display_volume}%"
else

    if [[ $command == "up" ]]; then
        pamixer --unmute --increase $increment
    elif [[ $command == "down" ]]; then
        pamixer --decrease $increment
    fi

    if [[ $command = "mute" ]]; then
        pamixer --toggle-mute
    fi

    get_icon

    find "${id_store}" -mmin +1 -exec rm {} \;
    [[ -f ${id_store} ]] && id=$(cat ${id_store})

    notify-send ' ' -i $icon_name -h int:value:$display_volume -h string:synchronous:volume -r $id -p > "${id_store}"
fi
