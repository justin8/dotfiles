#!/bin/bash
PICTURESDIR=$HOME/Pictures
LOG=$HOME/.$(basename ${0}).log
#set -x

exec > >(zenity --text-info) 2>&1
echo "" > $LOG

while [ -n "$*" ]
do
	echo "Sorting picture: $1"
	date=""
	echo "$1" | grep -q ".jpg$" && date=$(exiftool "$1"|grep "Date/Time Original"|awk '{print $4}'|sed 's/:/-/g')
	date=${date:-$(stat "$1"|grep Modify|awk '{print $2}')}

	outputdir=$PICTURESDIR/$(echo $date|grep -Eo "^[0-9]*")/$date/
	
	echo "input: $1" >> $LOG
	echo "date: $date" >> $LOG
	echo "outputdir: $outputdir" >> $LOG
	echo "" >> $LOG

	mkdir -p "$outputdir"
	mv "$1" "$outputdir"
	shift
done
