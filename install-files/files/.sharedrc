#!/bin/bash
[[ -e $HOME/.sharedrc-addon ]] && source $HOME/.sharedrc-addon

# Add ~/.bin to path
export PATH=$HOME/.local/bin:$HOME/.local/gnubin:$PATH

# Force Gnome keyring usage if it is enabled
keyring_path="/run/user/${EUID}/keyring/ssh"
if [[ -e $keyring_path ]]
then
	export SSH_AUTH_SOCK="$keyring_path"
fi

# Aliases
alias vi=vim
alias less='less -R'
alias rsync='rsync --info=progress2'
alias grep='grep --color=auto'
alias ta='tmux -CC attach'

if [[ $(uname) == Linux ]]
then
	alias copy='copy --reflink=auto'
fi
export EDITOR="vim"

# Fix to make vim work with color themes
if [[ $TERM != linux ]]
then
	export TERM=xterm-256color
fi

# Path fix for RHEL/Debian
export PATH=$PATH:/usr/local/sbin:/usr/sbin:/sbin

# Add RVM to PATH
export PATH="$PATH:$HOME/.rvm/bin"

# Add linuxbrew to path
if [[ -e /home/linuxbrew/.linuxbrew ]]; then
	eval $(/home/linuxbrew/.linuxbrew/bin/brew shellenv)
fi

# Use NVM if it is installed
READLINK=readlink
which greadlink &>/dev/null && READLINK=greadlink
export NVM_DIR="$($READLINK -f "$HOME/.nvm")"
nvm(){
	echo "ðŸš¨ nvm not loaded! Loading now..."
	unset -f nvm
	[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"  # This loads nvm
	nvm "$@"
}

node(){
	echo "ðŸš¨ nvm not loaded! Loading now..."
	unset -f node
	[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"  # This loads nvm
	node "$@"
}

npm(){
	echo "ðŸš¨ nvm not loaded! Loading now..."
	unset -f npm
	[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"  # This loads nvm
	npm "$@"
}
# Enable python virtualenvs
if [[ -e $HOME/.pyenv ]]; then
	export PYENV_ROOT="$HOME/.pyenv"
	export PATH="$PYENV_ROOT/bin:$PATH"
	export WORKON_HOME=$HOME/.virtualenvs

	init_virtualenvwrapper() {
		eval "$(pyenv init -)"
		pyenv virtualenvwrapper_lazy
	}

	pyenv() {
		echo "ðŸš¨ pyenv not loaded! Loading now..."
		unset -f pyenv
		eval "$(pyenv init -)"
		pyenv "$@"
	}

	ipython() {
		echo "ðŸš¨ pyenv not loaded! Loading now..."
		unset -f ipython
		eval "$(pyenv init -)"
		ipython "$@"
	}

	python() {
		echo "ðŸš¨ pyenv not loaded! Loading now..."
		unset -f python
		eval "$(pyenv init -)"
		python "$@"
	}

	python2() {
		echo "ðŸš¨ pyenv not loaded! Loading now..."
		unset -f python2
		eval "$(pyenv init -)"
		python2 "$@"
	}

	python3() {
		echo "ðŸš¨ pyenv not loaded! Loading now..."
		unset -f python3
		eval "$(pyenv init -)"
		python3 "$@"
	}

	pip() {
		echo "ðŸš¨ pyenv not loaded! Loading now..."
		unset -f pip
		eval "$(pyenv init -)"
		pip "$@"
	}

	pip2() {
		echo "ðŸš¨ pyenv not loaded! Loading now..."
		unset -f pip2
		eval "$(pyenv init -)"
		pip2 "$@"
	}

	pip3() {
		echo "ðŸš¨ pyenv not loaded! Loading now..."
		unset -f pip3
		eval "$(pyenv init -)"
		pip3 "$@"
	}

	# Wrappers for virtualenv wrapper to load on-demand only
	mkvirtualenv() {
		unset -f mkvirtualenv
		init_virtualenvwrapper
		mkvirtualenv "$@"
	}

	rmvirtualenv() {
		unset -f rmvirtualenv
		init_virtualenvwrapper
		rmvirtualenv "$@"
	}

	workon() {
		unset -f workon
		init_virtualenvwrapper
		workon "$@"
	}

fi

# Add ~/.bin to path
export PATH=$HOME/.local/bin:$PATH

# Source nix if it is available
NIX_PATH="$HOME/.nix-profile/etc/profile.d/nix.sh"
if [[ -e $NIX_PATH ]]; then
	. $NIX_PATH
fi
